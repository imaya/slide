<!--
Google IO 2012/2013 HTML5 Slide Template

Authors: Eric Bidelman <ebidel@gmail.com>
         Luke Mahé <lukem@google.com>

URL: https://code.google.com/p/io-2012-slides
-->
<!DOCTYPE html>
<html>
<head>
  <title></title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="chrome=1">
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">-->
  <!--<meta name="viewport" content="width=device-width, initial-scale=1.0">-->
  <!--This one seems to work all the time, but really small on ipad-->
  <!--<meta name="viewport" content="initial-scale=0.4">-->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="google" value="notranslate">
  <link rel="stylesheet" media="all" href="theme/css/default.css">
  <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="theme/css/phone.css">
  <base target="_blank"> <!-- This amazingness opens all links in a new tab. -->
  <script data-main="js/slides" src="js/require-1.0.8.min.js"></script>
</head>
<body style="opacity: 0">

<slides class="layout-widescreen">

  <slide class="title-slide segue nobackground">
    <!--
    <aside class="gdbar"><img src="images/google_developers_icon_128.png"></aside>
    -->
    <!-- The content of this hgroup is replaced programmatically through the slide_config.json. -->
    <hgroup class="auto-fadein">
      <h1 data-config-title><!-- populated from slide_config.json --></h1>
      <h2 data-config-subtitle><!-- populated from slide_config.json --></h2>
      <p data-config-presenter><!-- populated from slide_config.json --></p>
      <p data-config-contact><!-- populated from slide_config.json --></p>
    </hgroup>
  </slide>

  <slide>
    <hgroup>
      <h2>Web Audio API の簡単な使い方</h2>
    </hgroup>
    <article>
      <ul>
        <li>AudioContext オブジェクトを作る (webkit とかの prefix がついたりする)</li>
        <li>AudioContext から用途に応じて好きな AudioNode を作る</li>
        <li></li>
      </ul>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>smfplayer.js, sf2synth.js とは</h2>
    </hgroup>
    <article>
      <h3>smfplayer.js: 標準 MIDI ファイルプレイヤー</h3>
        <ul>
          <li>標準 MIDI ファイルを読み込んで WebMidiLink 対応のシンセサイザを鳴らす</li>
          <li>MFi(着メロ) にもこっそり対応してる
            <ul>
              <li>MFi の場合は SMF に変換する処理が入る</li>
            </ul>
          </li>
        </ul>
      <h3>sf2synth.js: SoundFont シンセサイザ</h3>
        <ul>
          <li>要は SoundFont を WebMidiLink の音源として使えるようにする</li>
          <li>Windows などは標準のMIDI音源 (MSGS: Microsoft GS Wavetable SW Synth) があるが、ブラウザでは利用できないので必要になる</li>
        </ul>
      <h3>WebMidiLink</h3>
        <ul>
          <li>ブラウザで動作するシンセサイザのやりとりをする仕様</li>
          <li>ざっくり言うと MIDI メッセージのやり取りを window.postMessage で行うときのルール</li>
        </ul>

    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>SoundFont とは</h2>
    </hgroup>
    <article>
      <ul>
        <li>サンプラーのデータフォーマット</li>
        <li>今の主流は SoundFont2 (*.sf2)</li>
        <li>GM (General MIDI: 一般的なMIDI) の音色マップに対応した形のデータもある</li>
        <li>音色の音域毎に、サンプリングされた音とその音の音程やループポイントなどが指定されている</li>
        <li>Windows では MSGS を嫌がって Timidity++ というソフトウェアと SoundFont を使う人も多い</li>
        <li>結構サイズは大きい(数MB-1GBクラスのものもある)</li>
      </ul>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>sf2synth.js における SoundFont の扱い(概要)</h2>
    </hgroup>
    <article>
      <h3>対応機能</h3>
      <ul>
        <li>音程の変化は平均律を再生速度の変更で行うことで実装</li>
        <li>Volume/Modulation Envelope 対応</li>
        <li>再生中の pitch bend (音程変更パラメータ)の変更に対応</li>
      </ul>
      <h4>Envelope</h4>
      <ul>
        <li>いわゆる ADSR というパラメータ。 以下は Volume Envelope の時の例(Modulation Envelope の場合は音量ではなく変化させる度合いとなる)</li>
        <li>Attack: 鳴らし始めて最大音量になるまでの時間</li>
        <li>Decay: Sustain レベルになるまでの時間</li>
        <li>Sustain: 鳴らし続けているときの音量</li>
        <li>Release: 鳴らし終わった時、完全に消えるまでの時間</li>
        <li>SoundFont では Delay(立ち上がりまでの遅延時間), Hold(最大音量を維持する時間) というパラメータもある</li>
      </ul>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>sf2synth.js における SoundFont の扱い</h2>
    </hgroup>
    <article>
      <ul>
        <li>NoteOn ごとに BufferSource をつくって使い捨てる</li>
        <li>
          <ul>
            <li>作った BufferSource に Panner(左右の音量バランスの調整), GainNode(チャンネル単位の音量変更), BiquadFilter(ローパスフィルタ) をつなげる</li>
            <li>ADSR は AudioParam のスケジュール機能を利用 (setValueAtTime, linearRampToValueAtTime)</li>
            <li><a href="http://www.w3.org/TR/2013/WD-webaudio-20131010/#DynamicLifetime">使いすてるのも想定されている用途</a>なのでパフォーマンスにはほとんど影響しない</li>
          </ul>
        </li>
      </ul>
    </article>
  </slide>

  <slide>
    <hgroup>
      <h2>問題点</h2>
    </hgroup>
    <article>
      <ul>
        <li>Pitch Bend の変更で行われる頻繁に再生速度を変更する処理は重いので、特にモバイルではきつい</li>
        <li></li>
      </ul>
    </article>

  </slide>

  <slide class="thank-you-slide segue nobackground">
    <aside class="gdbar right"><img src="images/google_developers_icon_128.png"></aside>
    <article class="flexbox vleft auto-fadein">
      <h2>&lt;Thank You!&gt;</h2>
      <p>Important contact information goes here.</p>
    </article>
    <p class="auto-fadein" data-config-contact>
      <!-- populated from slide_config.json -->
    </p>
  </slide>

  <slide class="logoslide dark nobackground">
    <article class="flexbox vcenter">
      <span><img src="images/google_developers_logo_white.png"></span>
    </article>
  </slide>

  <slide class="backdrop"></slide>

</slides>

</body>
</html>
